<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
<style>
  body {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .line {
    fill: none;
    stroke-width: 1.5px;
  }

  .area {
    stroke-width: 1.5px;
    opacity: 0.6;
  }
</style>

<div id="chart"></div>

<script data-main="../src/require.config.js" src="../node_modules/requirejs/require.js"></script>
<script>
  require(["index"], function (jubilee) {
    var data = {
      series: [
        [
          { x: 16, y: 22, z: 0.2,
            pie: [
              { val: 41, label: "band"},
              { val: 18, label: "summary"},
              { val: 22, label: "is"},
              { val: 17, label: "what"},
              { val: 17, label: "good"}
            ]
          },
          { x: 20, y: 41, z: 0.5,
            pie: [
              { val: 41, label: "band"},
              { val: 18, label: "summary"},
              { val: 22, label: "is"},
              { val: 17, label: "what"},
              { val: 17, label: "good"}
            ]
          },
          { x: 25, y: 18, z: 0.6,
            pie: [
              { val: 41, label: "band"},
              { val: 18, label: "summary"},
              { val: 22, label: "is"},
              { val: 17, label: "what"},
              { val: 17, label: "good"}
            ]
          },
          { x: 45, y: 17, z: 0.9,
            pie: [
              { val: 41, label: "band"},
              { val: 18, label: "summary"},
              { val: 22, label: "is"},
              { val: 17, label: "what"},
              { val: 17, label: "good"}
            ]
          },
          { x: 96, y: 17, z: 0.3,
            pie: [
              { val: 41, label: "band"},
              { val: 18, label: "summary"},
              { val: 22, label: "is"},
              { val: 17, label: "what"},
              { val: 17, label: "good"}
            ]
          }
        ]
      ]
    };

    var width = 700;
    var height = 400;
    var color = d3.scale.category10();
    var xScale = d3.scale.linear().domain([0, 100]).range([0, width]);
    var leftScale = d3.scale.linear().domain([0, 41]).range([height, 0]);
    var rightScale = d3.scale.linear().domain([0, 0.9]).range([height, 0]);

    var bars = jubilee.shape.rect()
      .x(function (d) { return xScale(d.x); })
      .y(function (d) { return leftScale(d.y); })
      .width(10)
      .height(function (d) { return height - leftScale(d.y); });

    var circles = jubilee.shape.circle()
      .cx(function (d) { return xScale(d.x); })
      .cy(function (d) { return rightScale(d.z); })
      .radius(5)
      .stroke(function (d, i) { return color(i); })
      .fill(function (d, i) { return color(i); });

    var line = d3.svg.line()
      .x(function (d) { return xScale(d.x); })
      .y(function (d) { return leftScale(d.y); })
      .interpolate("linear");

    var area = d3.svg.area()
      .x(function (d) { return xScale(d.x); })
      .y(function (d) { return rightScale(d.z); })
      .y0(function () { return rightScale(0); })
      .interpolate("cardinal");

    var lines = jubilee.shape.path()
      .pathGenerator(line)
      .pathClass("line");

    var areas = jubilee.shape.path()
      .pathGenerator(area)
      .pathClass("area")
      .fill("green");

    var pieWidth = 50;
    var pieHeight = 50;
    var pieChart = jubilee.chart.pie()
      .width(pieWidth)
      .height(pieHeight)
      .value(function (d) { return d.val; })
      .label(function (d) { return d.label; });

    var chart = jubilee.chart.xyzplot()
      .margin({top: 50, right: 50})
      .width(width)
      .height(height)
      .xScale(xScale)
      .leftScale(leftScale)
      .rightScale(rightScale)
      .shapes([areas, bars, circles, lines])
      .graphTransform(function (d) {
        return "translate(" + (xScale(d.x) - (pieWidth / 2)) + "," + (leftScale(d.y) - (pieHeight / 2)) + ")";
      })
      .graphData(function (d) { return d.pie; })
      .graphs(pieChart)
      .on("hover", function (d, i) {
        console.log(d, i);
      });

    d3.select("#chart")
      .datum(data.series)
      .call(chart);
  });
</script>
</body>
</html>
