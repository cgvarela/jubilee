<!DOCTYPE html>
<html>
  <head>
    <title>Canvas Heatmap</title>
  </head>
  <body>
    <style>
      body {
        font: 10px sans-serif;
      }

      canvas, svg {
        position: absolute;
        top: 0;
        left: 0;
      }

      .axis path {
        fill: none;
      }

      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
    </style>

    <div id="heatmap"></div>
    <script data-main="../../../src/require.config.js" src="../../../../node_modules/requirejs/require.js"></script>
    <script>
      require(["../../src/index"], function (jubilee) {
        var data = createHeatMapData(50);
        var rawData = [
          [
            { day: "Sun", y: 41, week: 1, z: 10},
            { day: "Mon", y: 18, week: 1, z: 13},
            { day: "Tue", y: 22, week: 1, z: 24},
            { day: "Wed", y: 17, week: 1, z: 36},
            { day: "Thu", y: 17, week: 1, z: 29},
            { day: "Fri", y: 25, week: 1, z: 29},
            { day: "Sat", y: 25, week: 1, z: 29}
          ],
          [
            { day: "Sun", y: 41, week: 2, z: 10},
            { day: "Mon", y: 18, week: 2, z: 13},
            { day: "Tue", y: 22, week: 2, z: 24},
            { day: "Wed", y: 17, week: 2, z: 36},
            { day: "Thu", y: 17, week: 2, z: 29},
            { day: "Fri", y: 25, week: 2, z: 29},
            { day: "Sat", y: 25, week: 2, z: 29}
          ],
          [
            { day: "Sun", y: 41, week: 3, z: 10},
            { day: "Mon", y: 18, week: 3, z: 13},
            { day: "Tue", y: 22, week: 3, z: 24},
            { day: "Wed", y: 17, week: 3, z: 36},
            { day: "Thu", y: 17, week: 3, z: 29},
            { day: "Fri", y: 25, week: 3, z: 29},
            { day: "Sat", y: 25, week: 3, z: 29}
          ]
        ];

        var timeData = d3.merge(rawData);
        timeData.forEach(function (d) {
          d.x = new Date(d.x);
        });

        var colorDomain = d3.extent(timeData, function (d) { return d.z; });
        var opacityDomain = d3.extent(timeData, function (d) { return d.z; });
        var colorScale = d3.scale.linear().domain(colorDomain).range(["blue", "red"]);
        var opacityScale = d3.scale.linear().domain(opacityDomain).range([0, 1]);

        var chart = jubilee.chart.heatmap()
          .margin({left: 100, bottom: 75})
          .height(500)
          .width(500)
          .padding(0.1)
          .x("week")
          .y("day")
          .xScale({ reverse: true })
          .canvas(false)
          .rect({
            fill: function (d) { return colorScale(d.z); },
            opacity: function (d) { return opacityScale(d.z); }
          })
          .xAxis({ show: true, filterTicksBy: 1 })
          .yAxis({ show: true, filterTicksBy: 1 })
          .on("mouseover", function (e, d, i) {
            console.log(e, d, i);
          });

        d3.select("#heatmap")
          .datum(timeData)
          .call(chart);

        function createHeatMapData(num) {
          var numArray = d3.range(num += 1);
          var points = num * num;
          var count = -1;
          var xIndex = 0;

          return Array.apply(null, new Array(points))
            .map(function (val, i) {
              if (count == (num - 1)) {
                count = -1;
                xIndex++;
              }
              count++;

              return {
                x: xIndex,
                y: count,
                z: +(Math.random() * 100).toFixed(2)
              };
            });
        }
      });
    </script>
  </body>
</html>
