<!DOCTYPE html>
<html>
  <head>
    <title>Canvas Heatmap</title>
  </head>
  <body>
    <style>
      body {
        font: 10px sans-serif;
      }

      canvas, svg {
        position: absolute;
        top: 0;
        left: 0;
      }

      .axis path {
        fill: none;
      }

      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
    </style>

    <div id="heatmap"></div>
    <script data-main="../../../src/require.config.js" src="../../../../node_modules/requirejs/require.js"></script>
    <script>
      require(["../../src/index"], function (jubilee) {
        var data = createHeatMapData(50);
        var colorDomain = d3.extent(data, function (d) { return d.z; });
        var opacityDomain = d3.extent(data, function (d) { return d.z; });
        var colorScale = d3.scale.linear().domain(colorDomain).range(["blue", "red"]);
        var opacityScale = d3.scale.linear().domain(opacityDomain).range([0, 1]);

        var chart = jubilee.chart.heatmap()
          .margin({left: 50, bottom: 50})
          .height(500)
          .width(500)
          .padding(0.1)
          .canvas(false)
          .yScale({ reverse: true })
          .rect({
            fill: function (d) { return colorScale(d.z); },
            opacity: function (d) { return opacityScale(d.z); }
          })
          .xAxis({ show: true, filterTicksBy: 2 })
          .yAxis({ show: true, filterTicksBy: 2 })
          .on("mouseover", function (e, d, i) {
            console.log(e, d, i);
          });

        d3.select("#heatmap")
          .datum(data)
          .call(chart);

        function createHeatMapData(num) {
          var numArray = d3.range(num += 1);
          var points = num * num;
          var count = -1;
          var xIndex = 0;

          return Array.apply(null, new Array(points))
            .map(function (val, i) {
              if (count == (num - 1)) {
                count = -1;
                xIndex++;
              }
              count++;

              return {
                x: xIndex,
                y: count,
                z: +(Math.random() * 100).toFixed(2)
              };
            });
        }
      });
    </script>
  </body>
</html>
